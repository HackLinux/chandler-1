--- M2Crypto-r261/setup.py	2005-05-04 21:07:40.000000000 -0700
+++ M2Crypto-r261-patched/setup.py	2005-05-04 21:23:41.287371200 -0700
@@ -12,6 +12,10 @@
 from distutils.core import setup, Extension
 from distutils.command import build_ext
 
+# XXX This is a hack to force search order that works
+# XXX for Chandler.
+from distutils.sysconfig import get_config_var
+
 if sys.version_info < (2,4):
 
     # This copy of swig_sources is from Python 2.2.
@@ -68,13 +72,23 @@
 
 if os.name == 'nt':
     openssl_dir = 'c:\\pkg\\openssl'
-    include_dirs = [my_inc, openssl_dir + '/include']
-    library_dirs = [openssl_dir + '\\lib']
+    # XXX This is a hack to force search order that works
+    # XXX for Chandler.
+    prefix_dir = get_config_var('prefix')
+    include_dirs = [prefix_dir + '\\..\\include',
+                    my_inc,
+                    openssl_dir + '/include']
+    library_dirs = [prefix_dir + '\\..\\lib',
+                    openssl_dir + '\\lib']
     libraries = ['ssleay32', 'libeay32']
     
 elif os.name == 'posix':
-    include_dirs = [my_inc, '/usr/include']
-    library_dirs = ['/usr/lib']
+    # XXX This is a hack to force search order that works
+    # XXX for Chandler.    
+    include_dirs = [get_config_var('INCLUDEDIR'),
+                    my_inc, '/usr/include']
+    library_dirs = [get_config_var('LIBDIR'),
+                    '/usr/lib']
     libraries = ['ssl', 'crypto']
 
 m2crypto = Extension(name = '__m2crypto',
