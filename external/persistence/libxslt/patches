--- libxslt-1.1.2/configure	Wed Dec 24 06:15:33 2003
+++ libxslt-1.1.2-patched/configure	Mon Jan 26 11:40:05 2004
@@ -20761,6 +20761,10 @@
     then
         echo Found python in $with_python/bin/python
         PYTHON="$with_python/bin/python"
+    elif test -x "$with_python/bin/python_d"
+    then
+        echo Found python in $with_python/bin/python_d
+        PYTHON="$with_python/bin/python_d"
     else
 	if test -x "$with_python"
 	then
--- libxslt-1.1.2/win32/configure.js	Sun Dec 21 03:01:27 2003
+++ libxslt-1.1.2-patched/win32/configure.js	Mon Jan 26 17:29:20 2004
@@ -9,6 +9,7 @@
 
 /* The source directory, relative to the one where this file resides. */
 var baseDir = "..";
+var srcDirXml = "..";
 var srcDirXslt = baseDir + "\\libxslt";
 var srcDirExslt = baseDir + "\\libexslt";
 var srcDirUtils = baseDir + "\\xsltproc";
@@ -45,6 +46,7 @@
 var withDebugger = true;
 var withIconv = true;
 var withZlib = false;
+var withPython = false;
 /* Win32 build options. */
 var dirSep = "\\";
 var compiler = "msvc";
@@ -166,6 +168,7 @@
 	vf.WriteLine("WITH_DEBUGGER=" + (withDebugger? "1" : "0"));
 	vf.WriteLine("WITH_ICONV=" + (withIconv? "1" : "0"));
 	vf.WriteLine("WITH_ZLIB=" + (withZlib? "1" : "0"));
+	vf.WriteLine("WITH_PYTHON=" + (withPython? "1" : "0"));
 	vf.WriteLine("DEBUG=" + (buildDebug? "1" : "0"));
 	vf.WriteLine("STATIC=" + (buildStatic? "1" : "0"));
 	vf.WriteLine("PREFIX=" + buildPrefix);
@@ -241,6 +244,31 @@
 	fso.CopyFile(optsFileExslt, optsFileExslt2, true);
 }
 
+/* Configures Python bindings. Otherwise identical to the above */
+function configureLibxmlPy()
+{
+	var pyOptsFileIn = srcDirXml + "\\python\\winSetup.py.in";
+	var pyOptsFile = srcDirXml + "\\python\\winSetup.py";
+	var fso, ofi, of, ln, s;
+	fso = new ActiveXObject("Scripting.FileSystemObject");
+	ofi = fso.OpenTextFile(pyOptsFileIn, 1);
+	of = fso.CreateTextFile(pyOptsFile, true);
+	while (ofi.AtEndOfStream != true) {
+		ln = ofi.ReadLine();
+		s = new String(ln);
+		if (s.search(/\@LIBXSLT_VERSION_NUMBER\@/) != -1) {
+			of.WriteLine(s.replace(/\@LIBXSLT_VERSION_NUMBER\@/, 
+				verMajorXslt*10000 + verMinorXslt*100 + verMicroXslt*1));
+		} else if (s.search(/\@prefix\@/) != -1) {
+			of.WriteLine(s.replace(/\@prefix\@/, buildPrefix));
+		} else
+			of.WriteLine(ln);
+	}
+	ofi.Close();
+	of.Close();
+}
+
+
 /* Creates the readme file for the binary distribution of 'bname', for the
    version 'ver' in the file 'file'. This one is called from the Makefile when
    generating a binary distribution. The parameters are passed by make. */
@@ -341,6 +369,8 @@
 			buildInclude = arg.substring(opt.length + 1, arg.length);
 		else if (opt == "lib")
 			buildLib = arg.substring(opt.length + 1, arg.length);
+		else if (opt == "python")
+			withPython = strToBool(arg.substring(opt.length + 1, arg.length));
 		else
 			error = 1;
 	} else if (i == 0) {
@@ -396,6 +426,14 @@
 	WScript.Quit(error);
 }
 
+if( withPython == true ){
+    configureLibxmlPy();
+    if(error != 0) {
+        WScript.Echo("Configuration failed, aborting.");
+        WScript.Quit(error);
+    }
+}
+
 // Create the Makefile.
 var fso = new ActiveXObject("Scripting.FileSystemObject");
 var makefile = ".\\Makefile.msvc";
@@ -423,6 +461,7 @@
 txtOut += "  Debugger support: " + boolToStr(withDebugger) + "\n";
 txtOut += "         Use iconv: " + boolToStr(withIconv) + "\n";
 txtOut += "         With zlib: " + boolToStr(withZlib) + "\n";
+txtOut += "   Python bindings: " + boolToStr(withPython) + "\n";
 txtOut += "\n";
 txtOut += "Win32 build configuration\n";
 txtOut += "-------------------------\n";
--- libxslt-1.1.2/Makefile.in	Wed Dec 24 06:15:26 2003
+++ libxslt-1.1.2-patched/Makefile.in	Fri Mar 12 13:51:38 2004
@@ -142,9 +142,7 @@
 	libxslt \
 	libexslt \
 	xsltproc \
-	doc \
-	@PYTHON_SUBDIR@ \
-	tests
+	@PYTHON_SUBDIR@
 
 
 DIST_SUBDIRS = libxslt libexslt xsltproc python doc tests
--- libxslt-1.1.2/win32/Makefile.msvc	2003-12-21 03:01:27.000000000 -0800
+++ libxslt-1.1.2-patched/win32/Makefile.msvc	2004-03-18 17:39:19.194859200 -0800
@@ -66,11 +66,11 @@
 
 # Optimisation and debug symbols.
 !if "$(DEBUG)" == "1"
-CFLAGS = $(CFLAGS) /D "_DEBUG" /Od /Z7
-LDFLAGS = $(LDFLAGS) /DEBUG
+CFLAGS = $(CFLAGS) /D "_DEBUG" /Od /Z7 /I..\..\..\libxml2\libxml2-2.6.10\win32\debug\include
+LDFLAGS = $(LDFLAGS) /DEBUG /LIBPATH:..\..\..\libxml2\libxml2-2.6.10\win32\debug\lib
 !else
-CFLAGS = $(CFLAGS) /D "NDEBUG" /O2 
-LDFLAGS = $(LDFLAGS) /OPT:NOWIN98
+CFLAGS = $(CFLAGS) /D "NDEBUG" /O2 /I..\..\..\libxml2\libxml2-2.6.10\win32\release\include
+LDFLAGS = $(LDFLAGS) /OPT:NOWIN98 /LIBPATH:..\..\..\libxml2\libxml2-2.6.10\win32\release\lib
 !endif
 
 # Libxslt object files.
