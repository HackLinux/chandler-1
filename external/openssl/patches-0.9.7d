--- openssl-0.9.7d/util/mk1mf.pl	Fri Nov 28 06:51:16 2003
+++ openssl-0.9.7d-patched/util/mk1mf.pl	Tue Jun  1 17:06:43 2004
@@ -487,6 +487,11 @@
 	chop;
 
 	($key,$val)=/^([^=]+)=(.*)/;
+	
+	# On some Windows machines, $val has linefeeds at the end, which confuses
+	# subsequent code in this file. So we strip all whitespace at the end.
+	$val =~ s/\s+$//;
+	
 	if ($key eq "RELATIVE_DIRECTORY")
 		{
 		if ($lib ne "")
--- openssl-0.9.7d/Makefile.org	Wed Mar 17 04:08:47 2004
+++ openssl-0.9.7d-patched/Makefile.org	Mon Jun  7 18:11:10 2004
@@ -303,7 +303,7 @@
 	fi; \
 	( set -x; ${CC} --verbose -dynamiclib -o lib$$i${SHLIB_EXT} \
 		lib$$i.a $$libs -all_load -current_version ${SHLIB_MAJOR}.${SHLIB_MINOR} \
-		-compatibility_version ${SHLIB_MAJOR}.`echo ${SHLIB_MINOR} | cut -d. -f1` \
+		-compatibility_version ${SHLIB_MAJOR}.${SHLIB_MINOR} \
 		-install_name ${INSTALLTOP}/lib/lib$$i${SHLIB_EXT} ) || exit 1; \
 	libs="-l`basename $$i${SHLIB_EXT} .dylib` $$libs"; \
 	echo "" ; \
