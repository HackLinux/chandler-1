<?xml version="1.0" encoding="iso-8859-1"?>

<!-- Copyright (c) 2004 Open Source Applications Foundation -->
<!-- License: http://osafoundation.org/Chandler_0.1_license_terms.htm -->

<Parcel describes="//parcels/osaf/framework/crypto"
        itsName="crypto"
        xmlns="http://osafoundation.org/parcels/core"
        xmlns:crypto="http://osafoundation.org/parcels/osaf/framework/crypto"
        xmlns:utils="http://osafoundation.org/parcels/osaf/framework/utils"
        >

  <displayName>Crypto Kinds</displayName>
  <description>Crypto Kinds</description>
  <version>0.3</version>

  <!-- Kind: PrivateKey -->

  <Kind itsName="PrivateKey">
    <displayName>Private Key</displayName>
    <description>The private key for a certificate. A private key is needed to decrypt communications sent to you, and to encrypt communications sent by you. A private key should never be shared (although it may be replicated). All of the attributes are dynamically computed/extract from the pem attribute.</description>

    <!-- cipher -->
    <!-- XXX should probably choose from enum -->
    <Attribute itsName="cipher">
      <displayName>cipher</displayName>
      <type itemref="String"/>
      <cardinality>single</cardinality>
    </Attribute>

    <!-- isEncrypted -->
    <Attribute itsName="isEncrypted">
      <displayName>isEncrypted</displayName>
      <type itemref="Boolean"/>
      <cardinality>single</cardinality>
    </Attribute>

    <!-- bits -->
    <!-- XXX should probably choose from enum -->
    <Attribute itsName="bits">
      <displayName>bits</displayName>
      <type itemref="Integer"/>
      <cardinality>single</cardinality>
    </Attribute>

    <!-- pem -->
    <Attribute itsName="pem">
      <displayName>pem</displayName>
      <description>This attribute holds the actual private key. All the other attributes are computed or extracted from this. This should generally be password protected.</description>
      <type itemref="Text"/>
      <cardinality>single</cardinality>
    </Attribute>

    <!-- certificate -->
    <Attribute itsName="certificate">
      <displayName>certificate</displayName>
      <type itemref="crypto:Certificate"/>
      <cardinality>single</cardinality>
      <inverseAttribute itemref="crypto:Certificate"/>
    </Attribute>

    <attributes itemref="crypto:PrivateKey/cipher"/>
    <attributes itemref="crypto:PrivateKey/isEncrypted"/>
    <attributes itemref="crypto:PrivateKey/bits"/>
    <attributes itemref="crypto:PrivateKey/pem"/>
    <attributes itemref="crypto:PrivateKey/certificate"/>

    <superKinds itemref="Item"/>
    <classes key="python">osaf.framework.crypto.PrivateKeyItem.PrivateKeyItem</classes>
  </Kind>

  <!-- Kind: Certificate -->

  <Kind itsName="Certificate">
    <displayName>Certificate</displayName>
    <description>The Kind for X.509 certificates. All of the attributes are dynamically computed except for the pem attribute, which stores the actual certificate.</description>

    <!-- notBefore -->
    <Attribute itsName="notBefore">
      <displayName>notBefore</displayName>
      <type itemref="DateTime"/>
      <cardinality>single</cardinality>
    </Attribute>

    <!-- notAfter -->
    <Attribute itsName="notAfter">
      <displayName>notAfter</displayName>
      <type itemref="DateTime"/>
      <cardinality>single</cardinality>
    </Attribute>

    <!-- isCA -->
    <Attribute itsName="isCA">
      <displayName>isCA</displayName>
      <type itemref="Boolean"/>
      <cardinality>single</cardinality>
    </Attribute>

    <!-- fingerprint -->
    <!-- XXX Might want this to be a number -->
    <Attribute itsName="fingerprint">
      <displayName>fingerprint</displayName>
      <description>A fingerprint can be used by humans to verify that the certificate belongs to the person/entity they think it belongs to. A fingerprint should be verified out of band, for example in actual face-to-face meeting, or telephone conversation or so forth.</description>
      <type itemref="String"/>
      <cardinality>single</cardinality>
    </Attribute>

    <!-- subjectName -->
    <!-- XXX subject might need to be a more complex object -->
    <Attribute itsName="subjectName">
      <displayName>subjectName</displayName>
      <type itemref="String"/>
      <cardinality>single</cardinality>
    </Attribute>

    <!-- issuerName -->
    <!-- XXX issuer might need to be a more complex object -->
    <Attribute itsName="issuerName">
      <displayName>issuerName</displayName>
      <type itemref="String"/>
      <cardinality>single</cardinality>
    </Attribute>

    <!-- serialNumber -->
    <!-- XXX can this be limited to positive? -->
    <Attribute itsName="serialNumber">
      <displayName>serialNumber</displayName>
      <type itemref="Integer"/>
      <cardinality>single</cardinality>
    </Attribute>

    <!-- version -->
    <!-- XXX should probably choose from enum -->
    <Attribute itsName="version">
      <displayName>version</displayName>
      <type itemref="Integer"/>
      <cardinality>single</cardinality>
    </Attribute>

    <!-- signatureAlgorithm -->
    <!-- XXX should probably choose from enum -->
    <Attribute itsName="signatureAlgorithm">
      <displayName>signatureAlgorithm</displayName>
      <type itemref="String"/>
      <cardinality>single</cardinality>
    </Attribute>

    <!-- publicKeyAlgorithm -->
    <!-- XXX should probably choose from enum -->
    <Attribute itsName="publicKeyAlgorithm">
      <displayName>publicKeyAlgorithm</displayName>
      <type itemref="String"/>
      <cardinality>single</cardinality>
    </Attribute>

    <!-- rsaPublicKeyBits -->
    <!-- XXX should probably choose from enum -->
    <Attribute itsName="rsaPublicKeyBits">
      <displayName>rsaPublicKeyBits</displayName>
      <type itemref="Integer"/>
      <cardinality>single</cardinality>
    </Attribute>

    <!-- asText -->
    <Attribute itsName="asText">
      <displayName>asText</displayName>
      <description>The human readable version of the certificate.</description>
      <type itemref="String"/>
      <cardinality>single</cardinality>
    </Attribute>

    <!-- pem -->
    <Attribute itsName="pem">
      <displayName>pem</displayName>
      <description>The actual machine-readable certificate. All the other attributes of a certificate Item are calculated/extracted from this attribute.</description>
      <type itemref="Text"/>
      <cardinality>single</cardinality>
    </Attribute>

    <!-- markedTrusted -->
    <!-- XXX is this just an external property of the cert, or can we sign the cert? --> 
    <Attribute itsName="markedTrusted">
      <displayName>markedTrusted</displayName>
      <type itemref="Boolean"/>
      <cardinality>single</cardinality>
    </Attribute>

    <!-- private key -->
    <Attribute itsName="privateKey">
      <displayName>privateKey</displayName>
      <type itemref="crypto:PrivateKey"/>
      <cardinality>single</cardinality>
      <inverseAttribute itemref="crypto:PrivateKey"/>
    </Attribute>

    <attributes itemref="crypto:Certificate/notBefore"/>
    <attributes itemref="crypto:Certificate/notAfter"/>
    <attributes itemref="crypto:Certificate/isCA"/>
    <attributes itemref="crypto:Certificate/fingerprint"/>
    <attributes itemref="crypto:Certificate/subjectName"/>
    <attributes itemref="crypto:Certificate/issuerName"/>
    <attributes itemref="crypto:Certificate/isCA"/>
    <attributes itemref="crypto:Certificate/serialNumber"/>
    <attributes itemref="crypto:Certificate/version"/>
    <attributes itemref="crypto:Certificate/signatureAlgorithm"/>
    <attributes itemref="crypto:Certificate/publicKeyAlgorithm"/>
    <attributes itemref="crypto:Certificate/rsaPublicKeyBits"/>
    <attributes itemref="crypto:Certificate/asText"/>
    <attributes itemref="crypto:Certificate/markedTrusted"/>
    <attributes itemref="crypto:Certificate/pem"/>
    <attributes itemref="crypto:Certificate/privateKey"/>

    <superKinds itemref="Item"/>
    <classes key="python">osaf.framework.crypto.CertificateItem.CertificateItem</classes>
  </Kind>

  <!-- Kind: CA -->

  <Kind itsName="CA">
    <displayName>CA</displayName>
    <description>Certificate Authority (CA) Kind. The purpose for items of this Kind is to store all the information that is needed to run a CA. For example, each certificate has a serial number and a CA must make sure it never issues two certificates with the same serial number.</description>

    <!-- lastSerialNumber -->
    <Attribute itsName="lastSerialNumber">
      <displayName>lastSerialNumber</displayName>
      <type itemref="Integer"/>
      <cardinality>single</cardinality>
    </Attribute>

    <!-- XXX Might want to have references to Certificates and potentially
         XXX private keys as well from here -->

    <attributes itemref="crypto:CA/lastSerialNumber"/>

    <superKinds itemref="Item"/>
    <classes key="python">osaf.framework.crypto.CAItem.CAItem</classes>
  </Kind>

</Parcel>
